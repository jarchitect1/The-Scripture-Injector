/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var y=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var L=(l,t)=>{for(var e in t)y(l,e,{get:t[e],enumerable:!0})},F=(l,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of D(t))!J.call(l,s)&&s!==e&&y(l,s,{get:()=>t[s],enumerable:!(r=z(t,s))||r.enumerable});return l};var K=l=>F(y({},"__esModule",{value:!0}),l);var O={};L(O,{default:()=>V});module.exports=K(O);var c=require("obsidian");var v=class extends Error{constructor(t,e,r){super(t),this.name="BibleAPIError",this.status=e,this.code=r}};var m=class{handleError(t,e){let r=t instanceof Error?t.message:String(t),s,n;if(t&&typeof t=="object"){let i=t;"status"in i&&typeof i.status=="number"&&(s=i.status),"code"in i&&typeof i.code=="string"&&(n=i.code)}let a=`Failed to fetch verse from ${e}: ${r}`;throw new v(a,s,n)}};var x=require("obsidian"),b=class extends m{constructor(e){super();this.baseUrl="https://api.esv.org/v3/passage/text/";if(!e)throw new Error("ESV API key is required");this.apiKey=e}async fetchVerse(e){try{let r=`${this.baseUrl}?q=${encodeURIComponent(e)}`,s=await(0,x.requestUrl)({url:r,method:"GET",headers:{Authorization:`Token ${this.apiKey}`}});if(s.status!==200)throw new Error(`ESV API error: ${s.status}`);try{let n=JSON.parse(s.text);if(!n.passages||!Array.isArray(n.passages)||n.passages.length===0)throw new Error("No passages found in ESV API response");let a=n.passages[0].trim(),i=n.canonical||e,o=a.split(`
`);return o.length>1&&o.shift(),a=o.join(`
`).trim(),a=a.replace(/\(ESV\)\s*$/,""),a=a.replace(/\[/g,"<sup>").replace(/\]/g,"</sup>"),{reference:i,text:a,translation:"ESV"}}catch(n){throw new Error("Failed to parse ESV API response")}}catch(r){this.handleError(r,"ESV API")}}async testConnection(){try{let e=await(0,x.requestUrl)({url:`${this.baseUrl}?q=John+3:16`,method:"GET",headers:{Authorization:`Token ${this.apiKey}`}});if(e.status!==200)return!1;try{let r=JSON.parse(e.text);return r.passages&&Array.isArray(r.passages)&&r.passages.length>0}catch(r){return!1}}catch(e){return!1}}};var A=require("obsidian"),N=class extends m{constructor(){super(...arguments);this.baseUrl="https://labs.bible.org/api/?"}async fetchVerse(e){try{let r=`${this.baseUrl}passage=${encodeURIComponent(e)}&formatting=para`,s=await(0,A.requestUrl)({url:r,method:"GET"});if(s.status!==200)throw new Error(`NET Bible API error: ${s.status}`);let n=s.text;if(!n||n.trim().length===0)throw new Error("No passage found for the given reference");let a=e.match(/^(\d?\s?\w+)\s+(\d+):/);if(!a){let u=e.match(/^(\d?\s?\w+)\s+(\d+)$/);if(!u)throw new Error("Invalid reference format");let B=u[1].trim(),R=u[2],C=/<b>(\d+(?::\d+)?|\d+)<\/b>/g,p=[],d;for(;(d=C.exec(n))!==null;){let T=d[1].includes(":")?parseInt(d[1].split(":")[1]):parseInt(d[1]);isNaN(T)||p.push(T)}let k=`${B} ${R}`;p.length>1?k+=`:${p[0]}-${p[p.length-1]}`:p.length===1&&(k+=`:${p[0]}`);let M=n.replace(/<b>/g,"<sup>").replace(/<\/b>/g,"</sup>").replace(/<p[^>]*>/g,"").replace(/<\/p>/g,`

`);return{reference:k,text:M,translation:"NET"}}let i=a[1].trim(),o=a[2],I=/<b>(\d+(?::\d+)?|\d+)<\/b>/g,h=[],g;for(;(g=I.exec(n))!==null;){let u=g[1].includes(":")?parseInt(g[1].split(":")[1]):parseInt(g[1]);isNaN(u)||h.push(u)}let $=`${i} ${o}`;h.length===1?$+=`:${h[0]}`:h.length>1&&($+=`:${h[0]}-${h[h.length-1]}`);let j=n.replace(/<b>/g,"<sup>").replace(/<\/b>/g,"</sup>").replace(/<p[^>]*>/g,"").replace(/<\/p>/g,`

`).trim();return{reference:$,text:j,translation:"NET"}}catch(r){this.handleError(r,"NET Bible API")}}async testConnection(){try{return(await(0,A.requestUrl)({url:`${this.baseUrl}passage=John%203:16`,method:"GET"})).status===200}catch(e){return!1}}validateReference(e){return/^[1-3]?\s?\w+\s+\d+:\d+(?:-\d+)?$/.test(e.trim())}};var w=class{constructor(){this.bookNames=new Map;this.bookAbbreviations=new Map;this.bookData=new Map;this.initializeBookMappings()}parse(t){let e=t.trim(),r=/^(\d?\s?\w+)\s+(\d+)(?::(\d+)(?:-(\d+))?)?(?:-(\d+):(\d+))?$/i,s=e.match(r);if(!s){let i=/^(\d?\s?\w+)\s+(\d+)$/i,o=e.match(i);if(o){let I=this.normalizeBookName(o[1]),h=parseInt(o[2]);return{book:I,chapter:h,verses:[],translation:""}}throw new Error(`Invalid Bible reference format: "${t}"`)}let n=this.normalizeBookName(s[1]),a=parseInt(s[2]);if(s[5]&&s[6]){let i=parseInt(s[6]),o=parseInt(s[3]||"1");return{book:n,chapter:a,verses:[{start:o,end:i}],translation:""}}if(s[3]){let i=parseInt(s[3]),o=s[4]?parseInt(s[4]):i;return{book:n,chapter:a,verses:[{start:i,end:o}],translation:""}}return{book:n,chapter:a,verses:[],translation:""}}normalizeBookName(t){let e=t.trim().toLowerCase().replace(/\s+/g,"");if(this.bookNames.has(e))return this.bookNames.get(e);if(this.bookAbbreviations.has(e))return this.bookAbbreviations.get(e);for(let[r,s]of this.bookAbbreviations)if(e.startsWith(r)||r.startsWith(e))return s;return t.trim()}getBookInfo(t){let e=this.normalizeBookName(t);return this.bookData.get(e)||null}validateReference(t){let e=[],r=this.getBookInfo(t.book);if(!r)return e.push(`Unknown book: "${t.book}"`),{valid:!1,errors:e};(t.chapter<1||t.chapter>r.chapters)&&e.push(`Invalid chapter ${t.chapter} for ${t.book}. Book has ${r.chapters} chapters.`);for(let s of t.verses)typeof s=="object"&&(s.start<1||s.end<s.start)&&e.push(`Invalid verse range: ${s.start}-${s.end}`);return{valid:e.length===0,errors:e}}initializeBookMappings(){let t=[{fullName:"Genesis",abbreviations:["gen","ge","gn"],chapters:50},{fullName:"Exodus",abbreviations:["exod","ex","exo"],chapters:40},{fullName:"Leviticus",abbreviations:["lev","le","lv"],chapters:27},{fullName:"Numbers",abbreviations:["num","nu","nm"],chapters:36},{fullName:"Deuteronomy",abbreviations:["deut","de","dt"],chapters:34},{fullName:"Joshua",abbreviations:["josh","jos","jsh"],chapters:24},{fullName:"Judges",abbreviations:["judg","jdg","jdgs"],chapters:21},{fullName:"Ruth",abbreviations:["ruth","ru","rt"],chapters:4},{fullName:"1 Samuel",abbreviations:["1sam","1sa","1sm"],chapters:31},{fullName:"2 Samuel",abbreviations:["2sam","2sa","2sm"],chapters:24},{fullName:"1 Kings",abbreviations:["1kgs","1ki","1k"],chapters:22},{fullName:"2 Kings",abbreviations:["2kgs","2ki","2k"],chapters:25},{fullName:"1 Chronicles",abbreviations:["1chr","1ch","1cr"],chapters:29},{fullName:"2 Chronicles",abbreviations:["2chr","2ch","2cr"],chapters:36},{fullName:"Ezra",abbreviations:["ezra","ezr"],chapters:10},{fullName:"Nehemiah",abbreviations:["neh","ne","nh"],chapters:13},{fullName:"Esther",abbreviations:["esth","est","es"],chapters:10},{fullName:"Job",abbreviations:["job"],chapters:42},{fullName:"Psalm",abbreviations:["ps","psalm"],chapters:150},{fullName:"Proverbs",abbreviations:["prov","pr","prv"],chapters:31},{fullName:"Ecclesiastes",abbreviations:["eccl","ecc","ec"],chapters:12},{fullName:"Song of Solomon",abbreviations:["song","ss","canticles"],chapters:8},{fullName:"Isaiah",abbreviations:["isa","is"],chapters:66},{fullName:"Jeremiah",abbreviations:["jer","je","jr"],chapters:52},{fullName:"Lamentations",abbreviations:["lam","la"],chapters:5},{fullName:"Ezekiel",abbreviations:["ezek","eze","ez"],chapters:48},{fullName:"Daniel",abbreviations:["dan","da","dn"],chapters:12},{fullName:"Hosea",abbreviations:["hos","ho"],chapters:14},{fullName:"Joel",abbreviations:["joel","jl"],chapters:3},{fullName:"Amos",abbreviations:["amos","am"],chapters:9},{fullName:"Obadiah",abbreviations:["obad","ob"],chapters:1},{fullName:"Jonah",abbreviations:["jonah","jon","jnh"],chapters:4},{fullName:"Micah",abbreviations:["mic","mi"],chapters:7},{fullName:"Nahum",abbreviations:["nah","na"],chapters:3},{fullName:"Habakkuk",abbreviations:["hab","ha"],chapters:3},{fullName:"Zephaniah",abbreviations:["zeph","zep"],chapters:3},{fullName:"Haggai",abbreviations:["hag","hg"],chapters:2},{fullName:"Zechariah",abbreviations:["zech","zec"],chapters:14},{fullName:"Malachi",abbreviations:["mal","ml"],chapters:4},{fullName:"Matthew",abbreviations:["matt","mt"],chapters:28},{fullName:"Mark",abbreviations:["mark","mk","mr"],chapters:16},{fullName:"Luke",abbreviations:["luke","lk"],chapters:24},{fullName:"John",abbreviations:["john","jn"],chapters:21},{fullName:"Acts",abbreviations:["acts","ac"],chapters:28},{fullName:"Romans",abbreviations:["rom","ro","rm"],chapters:16},{fullName:"1 Corinthians",abbreviations:["1cor","1co","1cr"],chapters:16},{fullName:"2 Corinthians",abbreviations:["2cor","2co","2cr"],chapters:13},{fullName:"Galatians",abbreviations:["gal","ga"],chapters:6},{fullName:"Ephesians",abbreviations:["eph","ep"],chapters:6},{fullName:"Philippians",abbreviations:["phil","php","pp"],chapters:4},{fullName:"Colossians",abbreviations:["col","co"],chapters:4},{fullName:"1 Thessalonians",abbreviations:["1thess","1th","1thes"],chapters:5},{fullName:"2 Thessalonians",abbreviations:["2thess","2th","2thes"],chapters:3},{fullName:"1 Timothy",abbreviations:["1tim","1ti","1tm"],chapters:6},{fullName:"2 Timothy",abbreviations:["2tim","2ti","2tm"],chapters:4},{fullName:"Titus",abbreviations:["titus","tit","ti"],chapters:3},{fullName:"Philemon",abbreviations:["philem","phm","pm"],chapters:1},{fullName:"Hebrews",abbreviations:["heb","he"],chapters:13},{fullName:"James",abbreviations:["jas","jam","jm"],chapters:5},{fullName:"1 Peter",abbreviations:["1pet","1pe","1pt"],chapters:5},{fullName:"2 Peter",abbreviations:["2pet","2pe","2pt"],chapters:3},{fullName:"1 John",abbreviations:["1john","1jn","1j"],chapters:5},{fullName:"2 John",abbreviations:["2john","2jn","2j"],chapters:1},{fullName:"3 John",abbreviations:["3john","3jn","3j"],chapters:1},{fullName:"Jude",abbreviations:["jude","jud","jd"],chapters:1},{fullName:"Revelation",abbreviations:["rev","re","rv"],chapters:22}];for(let e of t){let r=e.fullName.toLowerCase().replace(/\s+/g,"");this.bookNames.set(r,e.fullName),this.bookData.set(e.fullName,e);for(let s of e.abbreviations){let n=s.toLowerCase().replace(/\s+/g,"");this.bookAbbreviations.set(n,e.fullName)}}}};var E=class{formatVerseForObsidian(t,e){let r=t.reference,s=t.translation,n=t.text,a=e.verseCollapse?"> [!quote]- \u{1F4D6}":"> [!quote] \u{1F4D6}";return e.showReference&&(a+=` ${r}`),e.showTranslationName&&(e.showReference?a+=` (${s})`:a+=` ${s}`),n.split(`
`).forEach(o=>{a+=`
> ${o}`}),a+`

`}formatVerseForMarkdown(t,e){let r=t.reference,s=t.translation,n=t.text,a="> \u{1F4D6}";return e.showReference&&(a+=` **${r}**`),e.showTranslationName&&(e.showReference?a+=` (${s})`:a+=` **${s}**`),a+=`
>`,n.split(`
`).forEach(o=>{a+=`
> ${o}`}),a+`

`}formatVerseForPlainText(t,e){let r=t.reference,s=t.translation,n=t.text,a="";return e.showReference&&(a+=`${r}`),e.showTranslationName&&(e.showReference?a+=` (${s})`:a+=`${s}`),a?a+=`

${n}`:a=n,a+`

`}cleanVerseText(t,e){let r=t.trim();return e!=="ESV"&&(r=r.replace(/\[\d+\]/g,"")),r=r.replace(/\(\s*ESV\s*\)$/g,"").replace(/Â¶/g,"").replace(/\n\s*\n\s*\n/g,`
`).replace(/\s+/g," ").trim(),r}formatReference(t,e,r){if(r.length===0)return`${t} ${e}`;if(typeof r[0]=="number"){let s=r;return s.length===1?`${t} ${e}:${s[0]}`:s.length===2?`${t} ${e}:${s[0]}-${s[1]}`:`${t} ${e}:${s[0]}-${s[s.length-1]}`}else{let s=r;if(s.length===1){let n=s[0];return n.start===n.end?`${t} ${e}:${n.start}`:`${t} ${e}:${n.start}-${n.end}`}else{let n=s.map(a=>a.start===a.end?`${a.start}`:`${a.start}-${a.end}`);return`${t} ${e}:${n.join(",")}`}}}};var f=require("obsidian"),S=class extends f.Modal{constructor(e){super(e.app);this.isLoading=!1;this.plugin=e}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Insert bible verse"});let r=e.createDiv("reference-input-container");r.createEl("h3",{text:"Enter bible reference"}),this.referenceInput=r.createEl("input",{type:"text",placeholder:"e.g., John 3:16, Romans 8:28-39, Genesis 1:1-2:3"});let s=e.createDiv("translation-container");s.createEl("h3",{text:"Select translation"}),this.translationSelect=s.createEl("select"),this.translationSelect.createEl("option",{value:"ESV",text:"English Standard Version (ESV)"}),this.translationSelect.createEl("option",{value:"NET",text:"New English Translation (NET)"}),this.translationSelect.value=this.plugin.settings.defaultTranslation;let n=e.createDiv("button-container");this.fetchButton=n.createEl("button",{text:"Fetch verse",cls:"mod-cta"}),this.referenceInput.addEventListener("keypress",a=>{a.key==="Enter"&&this.fetchAndInsertVerse()}),this.fetchButton.addEventListener("click",()=>{this.fetchAndInsertVerse()}),this.referenceInput.focus()}onClose(){let{contentEl:e}=this;e.empty()}async fetchAndInsertVerse(){let e=this.referenceInput.value.trim(),r=this.translationSelect.value;if(!e){new f.Notice("Please enter a bible reference");return}if(!this.isLoading){this.isLoading=!0,this.fetchButton.textContent="Fetching...",this.fetchButton.disabled=!0;try{let s=await this.plugin.fetchVerse(e,r);this.insertVerse(s),this.close()}catch(s){new f.Notice(`Error: ${s instanceof Error?s.message:String(s)}`)}finally{this.isLoading=!1,this.fetchButton.textContent="Fetch verse",this.fetchButton.disabled=!1}}}insertVerse(e){this.plugin.insertVerse(e)}};var U={defaultTranslation:"NET",esvApiKey:"",showTranslationName:!0,showReference:!0,verseCollapse:!1},V=class extends c.Plugin{async onload(){await this.loadSettings(),this.referenceParser=new w,this.verseFormatter=new E,this.settings.esvApiKey&&(this.esvAPIService=new b(this.settings.esvApiKey)),this.netAPIService=new N,this.addCommand({id:"insert-bible-verse",name:"Insert bible verse",editorCallback:(t,e)=>{new S(this).open()}}),this.addSettingTab(new P(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},U,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.settings.esvApiKey&&(this.esvAPIService=new b(this.settings.esvApiKey))}async fetchVerse(t,e){try{let r=this.referenceParser.parse(t),s=this.referenceParser.validateReference(r);if(!s.valid)throw new Error(`Invalid reference: ${s.errors.join(", ")}`);if(e==="ESV"){if(!this.esvAPIService)throw new Error("ESV API key is required. Please add it in settings.");return await this.esvAPIService.fetchVerse(t)}else{if(e==="NET")return await this.netAPIService.fetchVerse(t);throw new Error(`Unsupported translation: ${e}`)}}catch(r){throw new Error(`Failed to fetch verse: ${r instanceof Error?r.message:String(r)}`)}}insertVerse(t){let e=this.app.workspace.getActiveViewOfType(c.MarkdownView);if(e){let r=e.editor,s=r.getCursor(),n=this.verseFormatter.formatVerseForObsidian(t,this.settings);r.replaceRange(n,s),new c.Notice(`Inserted: ${t.reference}`)}else new c.Notice("No active markdown editor found")}},P=class extends c.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new c.Setting(t).setName("The scripture injector settings").setHeading(),new c.Setting(t).setName("Default translation").setDesc("Select your preferred bible translation").addDropdown(e=>e.addOption("ESV","English Standard Version").addOption("NET","New English Translation").setValue(this.plugin.settings.defaultTranslation).onChange(async r=>{this.plugin.settings.defaultTranslation=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("ESV API key").setDesc("API key for ESV bible API (required for ESV translation)").addText(e=>e.setPlaceholder("Enter your ESV API key").setValue(this.plugin.settings.esvApiKey).onChange(async r=>{this.plugin.settings.esvApiKey=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Show translation name").setDesc("Include translation name in formatted verses").addToggle(e=>e.setValue(this.plugin.settings.showTranslationName).onChange(async r=>{this.plugin.settings.showTranslationName=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Show reference").setDesc("Include bible reference in formatted verses").addToggle(e=>e.setValue(this.plugin.settings.showReference).onChange(async r=>{this.plugin.settings.showReference=r,await this.plugin.saveSettings()})),new c.Setting(t).setName("Verse collapse").setDesc("Display verses in collapsible format").addToggle(e=>e.setValue(this.plugin.settings.verseCollapse).onChange(async r=>{this.plugin.settings.verseCollapse=r,await this.plugin.saveSettings()}))}};
